<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Lido Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Lido Docs Blog Atom Feed"><title data-react-helmet="true">Deposit Security Committee manual | Lido Docs</title><meta data-react-helmet="true" property="og:url" content="https://lidofinance.github.io/guides/deposit-security-manual"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Deposit Security Committee manual | Lido Docs"><meta data-react-helmet="true" name="description" content="This instruction has been prepared for the participants of the Deposit Security Committee and describes the general points, the preparation steps to act as a guardian, and the details of the protection mechanism. The Deposit Security Committee is necessary to prevent the substitution of withdrawal credentials with frontrunning by node operators. Each member of the committee must perform several actions to ensure the security of deposits made by Lido. To participate in the validation, you will need to deploy a lido-council-daemon and prepare a private key for signing messages about the correctness of data or the need to stop deposits in case of attack."><meta data-react-helmet="true" property="og:description" content="This instruction has been prepared for the participants of the Deposit Security Committee and describes the general points, the preparation steps to act as a guardian, and the details of the protection mechanism. The Deposit Security Committee is necessary to prevent the substitution of withdrawal credentials with frontrunning by node operators. Each member of the committee must perform several actions to ensure the security of deposits made by Lido. To participate in the validation, you will need to deploy a lido-council-daemon and prepare a private key for signing messages about the correctness of data or the need to stop deposits in case of attack."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon-32x32.png"><link data-react-helmet="true" rel="canonical" href="https://lidofinance.github.io/guides/deposit-security-manual"><link data-react-helmet="true" rel="alternate" href="https://lidofinance.github.io/guides/deposit-security-manual" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://lidofinance.github.io/guides/deposit-security-manual" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.964611c4.css">
<link rel="preload" href="/assets/js/styles.60d6036a.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.b6450e87.js" as="script">
<link rel="preload" href="/assets/js/main.c9264237.js" as="script">
<link rel="preload" href="/assets/js/1.a0af9a8d.js" as="script">
<link rel="preload" href="/assets/js/2.171cad78.js" as="script">
<link rel="preload" href="/assets/js/1a4e3797.64526be7.js" as="script">
<link rel="preload" href="/assets/js/1be78505.5269f7d6.js" as="script">
<link rel="preload" href="/assets/js/33.ca9d06ed.js" as="script">
<link rel="preload" href="/assets/js/32.3b8e323e.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.c8ba2edf.js" as="script">
<link rel="preload" href="/assets/js/17896441.8fe32cd9.js" as="script">
<link rel="preload" href="/assets/js/d848d958.702154d1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Lido Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Lido Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Lido Docs</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lidofinance" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_MM2z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_s5VG searchBarLoadingRing_2jQk"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Lido Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Lido Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Lido Docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/lidofinance" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/lido-dao">Lido DAO</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/node-operator-manual">Node Operator Manual</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/oracle-operator-manual">Oracle Operator Manual</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/guides/deposit-security-manual">Deposit Security Committee manual</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/multisig-deployment">Multisig deployment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/protocol-levers">Protocol levers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/etherscan-voting">DAO voting with Etherscan</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/easy-track-guide">Guide to Easy Track</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Integrations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/integrations/sdk">SDKs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/integrations/subgraph">Subgraph</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Token guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/token-guides/steth-superuser-functions">StETH superuser functions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contracts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contracts/lido">Lido</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contracts/lido-oracle">LidoOracle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contracts/stable-swap-state-oracle">StableSwapStateOracle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contracts/steth-price-feed">StEthPriceFeed</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contracts/node-operators-registry">NodeOperatorsRegistry</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contracts/withdrawals-manager-stub">WithdrawalsManagerStub</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contracts/wsteth">wstETH</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contracts/deposit-security-module">DepositSecurityModule</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/security/bugbounty">Bug Bounties with Immunefi</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/deployed-contracts">Deployed Contracts</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Deposit Security Committee manual</h1></header><div class="markdown"><p>This instruction has been prepared for the participants of the Deposit Security Committee and describes the general points, the preparation steps to act as a guardian, and the details of the protection mechanism. The Deposit Security Committee is necessary to prevent the substitution of withdrawal credentials with frontrunning by node operators. Each member of the committee must perform several actions to ensure the security of deposits made by Lido. To participate in the validation, you will need to deploy a <code>lido-council-daemon</code> and prepare a private key for signing messages about the correctness of data or the need to stop deposits in case of attack.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tldr"></a>TL;DR<a class="hash-link" href="#tldr" title="Direct link to heading">#</a></h2><p>Before running in the mainnet all steps should be done in the Goerli testnet.</p><ol><li>Prepare an EOA account for signing data with a private key on hand (not in hardware wallet). It will be a moderately sensitive hot private key. Use different accounts for testnet and mainnet.</li><li>Send the account address to Lido for submitting it to the smart contract. </li><li>Deploy and run <code>lido-council-daemon</code> with the private key from the EOA account. It would work in a dry-run mode until your address would be included in the smart contract.  </li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="detailed-description"></a>Detailed description<a class="hash-link" href="#detailed-description" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-vulnerability"></a>The vulnerability<a class="hash-link" href="#the-vulnerability" title="Direct link to heading">#</a></h3><p>There is the vulnerability allowing the malicious Node Operator to intercept the user funds on deposits to the Beacon chain in the Lido protocol. The vulnerability could only be exploited by the Node Operator front-running the <code>Lido.depositBufferedEther</code> transaction with direct deposit to the DepositContract of no less than 1 ETH with the same validator public key &amp; withdrawal credentials different from the Lido‚Äôs ones, effectively getting control over 32 ETH from Lido. To mitigate this, Lido contracts should be able to check that Node Operators‚Äô keys hadn‚Äôt been used for malicious pre-deposits.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-deposit-security-committee"></a>The Deposit Security Committee<a class="hash-link" href="#the-deposit-security-committee" title="Direct link to heading">#</a></h3><p>We propose to establish the Deposit Security Committee dedicated to ensuring the safety of deposits on the Beacon chain:</p><ul><li>monitoring the history of deposits and the set of Lido keys available for the deposit, signing and disseminating messages allowing deposits;</li><li>signing the special message allowing anyone to pause deposits once the malicious Node Operator pre-deposits are detected.</li></ul><p>To make a deposit, we propose to collect a quorum of 2/3 of the signatures of the committee members. Members of the committee can collude with node operators and steal money by signing bad data that contains malicious pre-deposits. To mitigate this we propose to allow single committee member to stop deposits and also enforce space deposits in time (e.g. no more than 150 deposits with 150 blocks in between them), to provide single honest participant an ability to stop further deposits even if the supermajority colludes. The idea was outlined on research forum post as the option <a href="https://research.lido.fi/t/mitigations-for-deposit-front-running-vulnerability/1239#d-approving-deposit-contract-merkle-root-7" target="_blank" rel="noopener noreferrer"><b>d</b></a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="committee-membership"></a>Committee membership<a class="hash-link" href="#committee-membership" title="Direct link to heading">#</a></h3><p>The first set of guardians is six node operators (Stakefish, Skillz, Chorus one, Blockscape, Staking facilities, P2P) and Lido dev team. In the future, we want to bring as many node operators as possible into the mix, so the expectation will be that while the 7 guardians start the rest of the node operators can also participate via testnet and gradually get pulled into mainnet. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="members-responsibilities"></a>Members responsibilities<a class="hash-link" href="#members-responsibilities" title="Direct link to heading">#</a></h3><p>Each member must prepare an EOA account to sign the pair <code>(depositRoot, keysOpIndex)</code> with its private key. The addresses of the committee members will be added to the smart contract. Also, member has to run <code>DSC Daemon</code>that monitors the validators‚Äô public keys in the <code>DepositContract</code> and <code>NodeOperatorRegistry</code>. The daemon must have access to the committee member‚Äôs private key to be able to perform ECDSA signing.</p><p>The daemon constantly watches all updates in <code>DepositContract</code> and <code>NodeOperatorRegistry</code>:</p><ul><li>If the state is correct, it signes the current to_sign struct and emits it to an off-chain message queue.</li><li>If the state has malicious pre-deposits, it signs the ‚Äúsomething‚Äôs wrong‚Äù message at the current block, emits it to a message queue, and attempts to send pauseDeposits() tx.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="preparation-steps"></a>Preparation steps<a class="hash-link" href="#preparation-steps" title="Direct link to heading">#</a></h2><p>Before running in the mainnet, all steps should be completed in the Goerli testnet.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="eoa-account"></a>EOA account<a class="hash-link" href="#eoa-account" title="Direct link to heading">#</a></h3><p>It might be any EOA account under the member&#x27;s control. Send the address of its account to Lido for submitting it to the smart contract. Lido will provide some ETH to make stopping transactions if needed (shouldn&#x27;t ever be the case). Note, all actions, except sending the stop message, would be done off-chain.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="run-lido-council-daemon"></a>Run lido-council-daemon<a class="hash-link" href="#run-lido-council-daemon" title="Direct link to heading">#</a></h3><p>For perform deposits validation each member should run the <code>lido-council-daemon</code> from <a href="https://github.com/lidofinance/lido-council-daemon" target="_blank" rel="noopener noreferrer">repository</a>.</p><p>The daemon monitors the keys in the deposit contract and compares them with Lido&#x27;s unused keys. The result of the comparison is signed with the private key and sent to the message broker. If the daemon finds a match, it tries to stop the deposits by sending a transaction calling the <code>pauseDeposits</code> method on the <code>Deposit Security Module</code> contract.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="run-with-docker"></a>Run with docker<a class="hash-link" href="#run-with-docker" title="Direct link to heading">#</a></h4><p>You can pull image from the the docker hub and run it manually or via docker-compose (<code>docker-compose.yml</code> can be found in repository root). Volumes can be omitted if needed.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull lidofinance/lido-council-daemon@sha256:f7c6c68eb6044fe747d094e4bd6256c6c88ac54029bd1a9b85e6f8f7c1586874</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -i -t </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -v </span><span class="token variable" style="color:rgb(191, 199, 213)">${</span><span class="token variable environment constant" style="color:rgb(130, 170, 255)">PWD</span><span class="token variable" style="color:rgb(191, 199, 213)">}</span><span class="token plain">/.volumes/council/cache:/council/cache/ </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -p </span><span class="token number" style="color:rgb(247, 140, 108)">3000</span><span class="token plain">:3000/tcp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">PORT</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;3000&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">LOG_LEVEL</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;debug&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">LOG_FORMAT</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;simple&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">RPC_URL</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&lt;rpc url&gt;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KAFKA_SSL</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;true&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KAFKA_SASL_MECHANISM</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;plain&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KAFKA_USERNAME</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&lt;kafka user&gt;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KAFKA_PASSWORD</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&lt;kafka password&gt;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KAFKA_BROKER_ADDRESS_1</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&lt;kafka address&gt;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">KAFKA_TOPIC</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">defender </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -e WALLET_PRIVATE_KEY </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  lidofinance/lido-council-daemon@sha256:f7c6c68eb6044fe747d094e4bd6256c6c88ac54029bd1a9b85e6f8f7c1586874</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Port 3000 is used for prometheus metrics. You don&#x27;t have to expose it if you don&#x27;t collect metrics.</p><p><code>RPC_URL</code> is the URI to web3 RPC you want to use (Goerli for testnet). <code>WALLET_PRIVATE_KEY</code> environment variable should be managed as a sensitive secret. The key should be in the <code>0xabcd...</code> format.</p><p>Note: every time the container starts fresh it warms up cache of historical data, stored in the volume you provide. Cache warming takes a lot of RPC queries and up to 30m of time. That cache is fully deterministic, fairly easily repopulated and you shouldn&#x27;t be afraid to lose it.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="run-from-source-code"></a>Run from source code<a class="hash-link" href="#run-from-source-code" title="Direct link to heading">#</a></h4><ol><li>Clone the repository:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone git@github.com:lidofinance/lido-council-daemon.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> lido-council-daemon</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ol start="2"><li>Install dependencies:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">yarn</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">yarn</span><span class="token plain"> typechain</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ol start="3"><li>Copy the contents of <code>sample.env</code> to <code>.env</code> file</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> sample.env .env</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ol start="4"><li>Configure daemon through environment variables in the previously created <code>.env</code> file:</li></ol><p>Messages broker, i.e. Kafka:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">KAFKA_USERNAME=&lt;kafka username&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">KAFKA_PASSWORD=&lt;kafka password&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">KAFKA_BROKER_ADDRESS_1=&lt;kafka broker address with port&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>A message broker is needed for data exchange between consuls and a depositor
bot.</p><p>The URI to web3 RPC you want to use (Goerli for testnet):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">RPC_URL=&lt;rpc url&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ol start="5"><li>Set private through environment variable (in the <code>0xabcd...</code> format):</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">export WALLET_PRIVATE_KEY=&lt;your-private-key&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>It is better not to store your private key in the <code>.env</code> file.</p><ol start="6"><li>Run:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">yarn</span><span class="token plain"> build</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">yarn</span><span class="token plain"> start:prod</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Note: every time the the daemons starts for the first time it warms up local cache of historical data, which takes a lot of RPC queries and about 30m of time. That cache is fully deterministic, fairly easily repopulated and you shouldn&#x27;t be afraid to lose it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="possible-startup-messages"></a>Possible startup messages<a class="hash-link" href="#possible-startup-messages" title="Direct link to heading">#</a></h3><p>All goes well:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">info: Account balance is sufficient {&quot;balance&quot;:&quot;1.0 ETH&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info: You address is in the Guardian List {&quot;address&quot;:&quot;0x0000000000000000000000000000000000000000&quot;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">debug: Fresh events are fetched {&quot;startBlock&quot;:5679826,&quot;endBlock&quot;:5679976,&quot;events&quot;:6}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">debug: Fresh events are fetched {&quot;startBlock&quot;:5679827,&quot;endBlock&quot;:5679977,&quot;events&quot;:6}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">debug: Fresh events are fetched {&quot;startBlock&quot;:5679828,&quot;endBlock&quot;:5679978,&quot;events&quot;:7}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info: No problems found {&quot;type&quot;:&quot;deposit&quot;,&quot;depositRoot&quot;:&quot;0xc2c9308fa425a64ef9cac1837412ba462b6429fce2f170184284a260b735638c&quot;,&quot;keysOpIndex&quot;:12,&quot;blockNumber&quot;:5679978,&quot;blockHash&quot;:&quot;0x87762c941f653f2f70157f86deac78f19e4d1549e231a52d1191289592d1a0ab&quot;,&quot;guardianAddress&quot;:&quot;0x3dc4cF780F2599B528F37dedB34449Fb65Ef7d4A&quot;,&quot;guardianIndex&quot;:0,&quot;signature&quot;:{&quot;r&quot;:&quot;0x44fec2e6fd34e74b8f001ef0e5bbd2db6d3179925fb82cb43231e19af46f0ddd&quot;,&quot;s&quot;:&quot;0x2ff4326af760e353803458b75279eb8f58e5735b3565ea16bcd0f773bce106a4&quot;,&quot;_vs&quot;:&quot;0xaff4326af760e353803458b75279eb8f58e5735b3565ea16bcd0f773bce106a4&quot;,&quot;recoveryParam&quot;:1,&quot;v&quot;:28}}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">debug: Fresh events are fetched {&quot;startBlock&quot;:5679829,&quot;endBlock&quot;:5679979,&quot;events&quot;:7}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>At the first startup the daemon will collect historical data for quite some time:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">info: Historical events are fetched {&quot;endBlock&quot;:4487322,&quot;events&quot;:3,&quot;startBlock&quot;:4467323}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Private key is not provided:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">warn: Private key is not provided, a random address will be generated for the test run</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Not enough ether on a user balance:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">warn: Account balance is too low {&quot;balance&quot;:&quot;0.0 ETH&quot;}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Dry-run case, your address is not in the smart contract:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">warn: You address is not in the Guardian List {&quot;address&quot;:&quot;0x0000000000000000000000000000000000000000&quot;}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/lidofinance/docs/blob/main/docs/guides/deposit-security-manual.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/guides/oracle-operator-manual"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Oracle Operator Manual</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/guides/multisig-deployment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Multisig deployment ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tldr" class="table-of-contents__link">TL;DR</a></li><li><a href="#detailed-description" class="table-of-contents__link">Detailed description</a><ul><li><a href="#the-vulnerability" class="table-of-contents__link">The vulnerability</a></li><li><a href="#the-deposit-security-committee" class="table-of-contents__link">The Deposit Security Committee</a></li><li><a href="#committee-membership" class="table-of-contents__link">Committee membership</a></li><li><a href="#members-responsibilities" class="table-of-contents__link">Members responsibilities</a></li></ul></li><li><a href="#preparation-steps" class="table-of-contents__link">Preparation steps</a><ul><li><a href="#eoa-account" class="table-of-contents__link">EOA account</a></li><li><a href="#run-lido-council-daemon" class="table-of-contents__link">Run lido-council-daemon</a></li><li><a href="#possible-startup-messages" class="table-of-contents__link">Possible startup messages</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/styles.60d6036a.js"></script>
<script src="/assets/js/runtime~main.b6450e87.js"></script>
<script src="/assets/js/main.c9264237.js"></script>
<script src="/assets/js/1.a0af9a8d.js"></script>
<script src="/assets/js/2.171cad78.js"></script>
<script src="/assets/js/1a4e3797.64526be7.js"></script>
<script src="/assets/js/1be78505.5269f7d6.js"></script>
<script src="/assets/js/33.ca9d06ed.js"></script>
<script src="/assets/js/32.3b8e323e.js"></script>
<script src="/assets/js/935f2afb.c8ba2edf.js"></script>
<script src="/assets/js/17896441.8fe32cd9.js"></script>
<script src="/assets/js/d848d958.702154d1.js"></script>
</body>
</html>