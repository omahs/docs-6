<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">stETH/wstETH integration guide | Lido Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://lidofinance.github.io/guides/steth-integration-guide"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="stETH/wstETH integration guide | Lido Docs"><meta data-react-helmet="true" name="description" content="This document is intended for developers looking to integrate Lido&#x27;s stETH or wstETH as an asset into their dApp, with a focus on money markets, DEXes and blockchain bridges."><meta data-react-helmet="true" property="og:description" content="This document is intended for developers looking to integrate Lido&#x27;s stETH or wstETH as an asset into their dApp, with a focus on money markets, DEXes and blockchain bridges."><link data-react-helmet="true" rel="icon" href="/img/favicon-32x32.png"><link data-react-helmet="true" rel="canonical" href="https://lidofinance.github.io/guides/steth-integration-guide"><link data-react-helmet="true" rel="alternate" href="https://lidofinance.github.io/guides/steth-integration-guide" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://lidofinance.github.io/guides/steth-integration-guide" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.8c219a48.css">
<link rel="preload" href="/assets/js/runtime~main.1683206d.js" as="script">
<link rel="preload" href="/assets/js/main.4049db9f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Lido Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="Lido Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Lido Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lidofinance" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lido-dao">Lido DAO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/guides/steth-integration-guide">stETH/wstETH integration guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/guides/node-operator-manual">Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/integrations/sdk">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/token-guides/steth-superuser-functions">Token guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/contracts/lido">Contracts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/security/bugbounty">Security</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/deployed-contracts">Deployed Contracts</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>stETH/wstETH integration guide</h1></header><p>This document is intended for developers looking to integrate Lido&#x27;s stETH or wstETH as an asset into their dApp, with a focus on money markets, DEXes and blockchain bridges.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="lido">Lido<a class="hash-link" href="#lido" title="Direct link to heading">â€‹</a></h2><p>Lido is a family of liquid staking protocols across multiple blockchains, with headquarters on Ethereum.
Liquid refers to the ability for a userâ€™s stake to become liquid. Upon user&#x27;s deposit Lido issues the derivative, which represents the deposited assets along with all the rewards &amp; penalties accrued through deposit&#x27;s staking. Unlike the staked funds, this derivative is liquid â€” it can be freely transferred between parties, making it usable across different DeFi applications while still accruing staking yield passively. It is paramount to preserve this property when integrating staking derivatives into any DeFi protocol.</p><p>This guide refers to Lido on Ethereum (hereinafter referred to as Lido).
For ether staked in Lido, it gives users stETH that is equal to the amount staked.</p><p>Lido&#x27;s staking derivatives are widely adopted across Ethereum ecosystem:</p><ul><li>The most important liquidity venues include <a href="https://curve.fi/steth" target="_blank" rel="noopener noreferrer">stETH/ETH liquidity pool on Curve</a> and <a href="https://app.balancer.fi/#/pool/0x32296969ef14eb0c6d29669c550d4a0449130230000200000000000000000080" target="_blank" rel="noopener noreferrer">wstETH/ETH MetaStable pool on Balancer v2</a>.</li><li>stETH is <a href="https://app.aave.com/reserve-overview/?underlyingAsset=0xae7ab96520de3a18e5e111b5eaab095312d7fe84&amp;marketName=proto_mainnet" target="_blank" rel="noopener noreferrer">listed as collateral asset on AAVE v2 market</a> on Ethereum mainnet.</li><li>wstETH is <a href="https://daistats.com/#/collateral" target="_blank" rel="noopener noreferrer">listed as collateral asset on Maker</a>.</li><li>steCRV (the Curve stETH/ETH LP token) is <a href="https://daistats.com/#/collateral" target="_blank" rel="noopener noreferrer">listed as collateral asset on Maker</a>.</li><li>ether stakers can collateralise their stETH (in the form of bETH) on the Terra blockchain using <a href="https://app.anchorprotocol.com/" target="_blank" rel="noopener noreferrer">Anchor protocol</a>.</li><li>there are multiple liquidity strategies built on top of Lido&#x27;s staking derivatives, including <a href="https://yearn.finance/#/vault/0xdCD90C7f6324cfa40d7169ef80b12031770B4325" target="_blank" rel="noopener noreferrer">yearn</a>, <a href="https://harvest.finance/" target="_blank" rel="noopener noreferrer">Harvest Finance</a>, and <a href="https://www.babylon.finance/garden/0xB5bD20248cfe9480487CC0de0d72D0e19eE0AcB6" target="_blank" rel="noopener noreferrer">Babylon Finance</a>.</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="integration-utilities-chainlink-price-feeds">Integration utilities: ChainLink price feeds<a class="hash-link" href="#integration-utilities-chainlink-price-feeds" title="Direct link to heading">â€‹</a></h4><ul><li>There are live ChainLink <a href="https://app.ens.domains/name/steth-usd.data.eth" target="_blank" rel="noopener noreferrer">stETH/USD</a> and <a href="https://etherscan.io/address/0x86392dC19c0b719886221c78AB11eb8Cf5c52812" target="_blank" rel="noopener noreferrer">stETH/ETH</a> price feeds on Ethereum.</li><li>There are live ChainLink stETH/USD price feeds on <a href="https://docs.chain.link/docs/arbitrum-price-feeds/" target="_blank" rel="noopener noreferrer">Arbitrum</a> and <a href="https://docs.chain.link/docs/optimism-price-feeds/" target="_blank" rel="noopener noreferrer">Optimism</a>. These also have ChainLink wstETH-stETH exchange rate data feeds.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="steth-vs-wsteth">stETH vs. wstETH<a class="hash-link" href="#steth-vs-wsteth" title="Direct link to heading">â€‹</a></h2><p>There are two versions of Lido&#x27;s staking derivative, namely stETH and wstETH.
Both tokens are ERC-20 tokens, but they reflect the accrued staking rewards in different ways. stETH implements rebasing mechanics which means the stETH balance increases periodically. In contrary, wstETH balance is constant, while the token increases in value eventually (denominated in stETH). At any moment, any amount of stETH can be converted to wstETH via trustless wrapper and vice versa, thus tokens effectively share liquidity.
For instance, undercollateralized wstETH positions on Maker can be liquidated by unwrapping wstETH and swapping it for ether on Curve.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="steth">stETH<a class="hash-link" href="#steth" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="what-is-steth">What is stETH<a class="hash-link" href="#what-is-steth" title="Direct link to heading">â€‹</a></h3><p>stETH is a ERC20 token that represents ether staked with Lido. Unlike staked ether, it is liquid and can be transferred, traded, or used in DeFi applications. Total supply of stETH reflects amount of ether deposited into protocol combined with staking rewards, minus potential validator penalties. stETH tokens are minted upon ether deposit at 1:1 ratio. When withdrawals from the Beacon chain will be introduced, it will also be possible to redeem ether by burning stETH at the same 1:1 ratio.</p><p>Please note, Lido has implemented staking rate limits aimed at reducing the post-Merge staking surge&#x27;s impact on the staking queue &amp; Lidoâ€™s socialized rewards distribution model. Read more about it <a href="#staking-rate-limits">here</a>.</p><p>stETH is a rebasable ERC-20 token. Normally, the stETH token balances get recalculated daily when the Lido oracle reports Beacon chain ether balance update. The stETH balance update happens automatically on all the addresses holding stETH at the moment of rebase. The rebase mechanics have been implemented via shares (see <a href="#steth-internals-share-mechanics">shares</a>).</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="the-beacon-chain-oracle">The Beacon chain oracle<a class="hash-link" href="#the-beacon-chain-oracle" title="Direct link to heading">â€‹</a></h3><p>Normally, stETH rebases happen daily when the Lido oracle reports the Beacon chain ether balance update. The rebase can be positive or negative, depending on the validators&#x27; performance. In case Lido&#x27;s validators get slashed, the stETH balances can decrease according to penalty sizes. However, daily rebases have never been negative by the time of writing.
The Beacon chain oracle has sanity checks on both max APR reported (the APR cannot exceed 10%, which means a daily rebase is limited to <code>10/365%</code>) and total staked amount drop (staked ether decrease reported cannot exceed 5%). Currently, the Beacon chain oracle report is based on five oracle daemons hosted by established node operators selected by the DAO. As soon as three out of five oracle daemons report matching Beacon chain data, the oracle reports it to the Lido smart contract, and the rebase occurs. There is a <a href="https://mainnet.lido.fi/#/lido-dao/0x442af784a788a5bd6f42a01ebe9f287a871243fb/" target="_blank" rel="noopener noreferrer">dedicated oracle dashboard</a> to monitor current Beacon chain reports.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="oracle-corner-cases">Oracle corner cases<a class="hash-link" href="#oracle-corner-cases" title="Direct link to heading">â€‹</a></h4><ul><li>In case oracle daemons do not report Beacon chain balance update or do not reach quorum, the oracle does not submit the daily report, and the daily rebase doesn&#x27;t occur until the quorum is reached.</li><li>In case the quorum hasn&#x27;t been reached, the oracle can skip the daily report. The report will happen as soon as the quorum for one of the next periods will be reached, and it will include the balance update for all the period since last oracle report.</li><li>Oracle daemons only report the finalized epochs. In case of no finality on the Beacon chain, the daemons won&#x27;t submit their reports, and the daily rebase won&#x27;t occur.</li><li>In case sanity checks on max APR or total staked amount drop fail, the oracle report cannot be finalized, and the rebase cannot happen.</li><li>StETH smart contract includes <a href="https://github.com/lidofinance/lido-dao/blob/816bf1d0995ba5cfdfc264de4acda34a7fe93eba/contracts/0.4.24/StETH.sol#L391" target="_blank" rel="noopener noreferrer">a method that allows burning stETH shares</a>. The method is meant for <a href="https://research.lido.fi/t/lip-6-in-protocol-coverage-proposal/1468" target="_blank" rel="noopener noreferrer">in-protocol cover</a>. When sETH shares get burnt, it triggers an immediate rebase, while the underlying ether adds up to the daily rewards for all stETH holders. This extra rebase doesn&#x27;t interfere with normal rebase schedule in any way.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="steth-internals-share-mechanics">stETH internals: share mechanics<a class="hash-link" href="#steth-internals-share-mechanics" title="Direct link to heading">â€‹</a></h3><p>Daily rebases result in stETH token balances changing. This mechanism is implemented via shares.
The <code>share</code> is a basic unit representing the stETH holder&#x27;s share in the total amount of ether controlled by the protocol. When a new deposit happens, the new shares get minted to reflect what share of the protocol controlled ether has been added to the pool. When the Beacon chain oracle report comes in, the price of 1 share in stETH is being recalculated. Shares aren&#x27;t normalized, so the contract also stores the sum of all shares to calculate each account&#x27;s token balance.
Shares balance by stETH balance can be calculated by this formula:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">shares[account] = balanceOf(account) * totalShares / totalPooledEther</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1-wei-corner-case">1 wei corner case<a class="hash-link" href="#1-wei-corner-case" title="Direct link to heading">â€‹</a></h3><p>stETH balance calculation includes integer division, and there is a common case when the whole stETH balance can&#x27;t be transferred from the account, while leaving the last 1 wei on the sender&#x27;s account. Same thing can actually happen at any transfer or deposit transaction.</p><p>Example:</p><ol><li>User A transfers 1 stETH to User B.</li><li>Under the hood, stETH balance gets converted to shares, integer division happens and rounding down applies.</li><li>Corresponding amount of shares gets transferred from User A to User B.</li><li>Shares balance gets converted to stETH balance for User B.</li><li>In many cases the actually transferred amount is 1 wei less than expected.</li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="bookkeeping-shares">Bookkeeping shares<a class="hash-link" href="#bookkeeping-shares" title="Direct link to heading">â€‹</a></h3><p>Although user friendly, stETH rebases add a whole level of complexity to integrating stETH into other dApps and protocols. When integrating stETH as an assets into any dApp, it&#x27;s highly recommended to store and operate shares rather than stETH public balances directly, because stETH balances change both upon transfers, mints/burns, and rebases, while shares balances can only change upon transfers and mints/burns.</p><p>To figure out the shares balance, <code>getSharesByPooledEth(uint256)</code> function can be used. It returns the value not affected by future rebases and it can be converted back into stETH by calling <code>getPooledEthByShares</code> function.</p><blockquote><p>See all available stETH methods <a href="https://github.com/lidofinance/docs/blob/main/docs/contracts/lido.md#view-methods" target="_blank" rel="noopener noreferrer">here</a>.</p></blockquote><p>Any operation on stETH can be performed on shares directly, with no difference between share and stETH.</p><p>The preferred way of operating stETH should be:
1) get stETH token balance;
2) convert stETH balance into shares balance and use it as primary balance unit in your dapp;
3) when any operation on the balance should be done, do it on shares balance;
4) when users interact with stETH, convert shares balance back to stETH token balance.</p><p>Please note that 10% APR on shares balance and 10% APR on stETH token balance will ultimately result in different output values over time, because shares balance is stable, while stETH token balance changes eventually.</p><p>If using the rebasable stETH token is not an option for your integration, it is recommended to use wstETH instead of stETH. See how it works <a href="#wsteth">here</a>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="fees">Fees<a class="hash-link" href="#fees" title="Direct link to heading">â€‹</a></h3><p>Lido collects a percentage of the staking rewards as a protocol fee. The exact fee size is defined by the DAO and can be changed in the future via DAO voting. To collect the fee, the protocol mints new stETH token shares and assigns them to the fee recipients. Currenty, the fee collected by Lido protocol is 10% of staking rewards with half of it going to the node operators and the other half going to the protocol treasury.</p><p>Since total amount of Lido pooled ether tends to increase, the combined value of all holders&#x27; shares denominated in stETH increases respectively. Thus, the rewards effectively spread between each token holder proportionally to their share in the protocol TVL. So Lido mints new shares to the fee recipient, so that the total cost of the newly-minted shares exactly corresponds to the fee taken (calculated in basis points):</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">shares2mint * newShareCost = (_totalRewards * feeBasis) / 10000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">newShareCost = newTotalPooledEther / (prevTotalShares + shares2mint)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>which follows to:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        _totalRewards * feeBasis * prevTotalShares</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shares2mint = --------------------------------------------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                (newTotalPooledEther * 10000) - (feeBasis * _totalRewards)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="do-steth-rewards-compound">Do stETH rewards compound?<a class="hash-link" href="#do-steth-rewards-compound" title="Direct link to heading">â€‹</a></h3><p>stETH holders receive staking rewards, but those don&#x27;t compound. Actual APR diminishes slightly over time for two main reasons:</p><ol><li>Beacon chain rewards don&#x27;t compound. To get more rewards one should withdraw funds and re-deposit them, skimming rewards. Until withdrawals are enabled, that isn&#x27;t technically possible. So, while the Lido&#x27;s beacon chain balance increases over time, the yield bearing asset amount remains equal to deposited ether amount.</li><li>stETH holders receive rewards proportionally to their share in the stETH total supply. This share diminishes slightly over time because of the protocol fee on rewards eating up from other holders&#x27; shares eventually.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="wsteth">wstETH<a class="hash-link" href="#wsteth" title="Direct link to heading">â€‹</a></h2><p>Due to the rebasing nature of stETH, the stETH balance on holder&#x27;s address is not constant, it changes daily as oracle report comes in.
Although rebasable tokens are becoming a common thing in DeFi recently, many dApps do not support rebasing. For example, Maker, UniSwap, and SushiSwap are not designed for rebasable tokens. Listing stETH on these apps can result in holders not receiving their daily staking rewards which effectively defeats the benefits of liquid staking. To integrate with such dApps, there&#x27;s another form of Lido staking derivative called wstETH (wrapped staked ether).</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="what-is-wsteth">What is wstETH<a class="hash-link" href="#what-is-wsteth" title="Direct link to heading">â€‹</a></h3><p>wstETH is an ERC20 token that represents the account&#x27;s share of the total supply of stETH total supply (stETH token wrapper with static balances). For wstETH, 1 wei in <a href="#steth-internals-share-mechanics">shares</a> equals to 1 wei in balance. The wstETH balance and can only be changed upon transfers, minting, and burning. wstETH balance does not rebase, wstETH&#x27;s price denominated in stETH changes instead.
At any given time, anyone holding wstETH can convert any amount of it to stETH at a fixed rate, and vice versa. The rate is the same for everyone at any given moment. Normally, the rate gets updated once a day, when stETH undergoes a rebase. The current rate can be obtained by calling <code>wstETH.stEthPerToken()</code></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="wsteth-shortcut">wstETH shortcut<a class="hash-link" href="#wsteth-shortcut" title="Direct link to heading">â€‹</a></h4><p>Note, that WstETH contract includes a shortcut to convert ether to wstETH under the hood, which allows to effectively skip the wrapping step and stake ether for wstETH directly. Keep in mind that when using the shortcut, <a href="#staking-rate-limits">the staking rate limits</a> still apply.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="rewards-accounting">Rewards accounting<a class="hash-link" href="#rewards-accounting" title="Direct link to heading">â€‹</a></h3><p>Since wstETH represents the holder&#x27;s share in the total amount of Lido-controlled ether, rebases don&#x27;t affect wstETH balances, but change the wstETH price denominated in stETH.</p><p><strong>Basic example</strong>:</p><p>1) User wraps 1 stETH and gets 0.9803 wstETH (1 stETH = 0.9803 wstETH)
2) A rebase happens, the wstETH price goes up by 5%
3) User unwraps 0.9803 wstETH and gets 1.0499 stETH (1 stETH = 0.9337 wstETH)</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="wrap--unwrap">Wrap &amp; Unwrap<a class="hash-link" href="#wrap--unwrap" title="Direct link to heading">â€‹</a></h3><p>When wrapping stETH to wstETH, the desired amount of stETH is being locked on the WstETH contract balance, and the wstETH is being minted according to the <a href="#bookkeeping-shares">shares bookeeping</a> formula.</p><p>When unwrapping, wstETH gets burnt and the corresponding amount of stETH gets unlocked.</p><p>Thus, amount of stETH unlocked when unwrapping is different from what has been initially wrapped (given a rebase happened between wrapping and unwrapping stETH).</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="erc20permit">ERC20Permit<a class="hash-link" href="#erc20permit" title="Direct link to heading">â€‹</a></h2><p>wstETH token implements the ERC20 Permit extension allowing approvals to be made via signatures, as defined in <a href="https://eips.ethereum.org/EIPS/eip-2612" target="_blank" rel="noopener noreferrer">EIP-2612</a>.</p><p>The <code>permit</code> method allows users to modify the allowance using a signed message, instead of through <code>msg.sender</code>.
By not relying on <code>approve</code> method, you can build interfaces that will approve and use wstETH in one tx.</p><p>NB: stETH token itself does not support the ERC20 Permit extension and it&#x27;s not possible to approve and wrap stETH in one tx at this time.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="staking-rate-limits">Staking rate limits<a class="hash-link" href="#staking-rate-limits" title="Direct link to heading">â€‹</a></h2><p>As thereâ€™s a high probability of the staking surge post-Merge, the Lido protocol implemented staking rate limits aimed at reducing the surge&#x27;s impact on the staking queue &amp; Lidoâ€™s socialized rewards distribution model.
there is a sliding window limit that is parametrized with <code>_maxStakingLimit</code> and <code>_stakeLimitIncreasePerBlock</code>. This means it is only possible to submit this much ether to the Lido staking contracts within a 24 hours timeframe. Currently, the daily staking limit is set at 150,000 ether.</p><p>You can picture this as a health globe from Diablo 2 with a maximum of <code>_maxStakingLimit</code> and regenerating with a constant speed  per block.
When you deposit ether to the protocol, the level of health is reduced by its amount and the current limit becomes smaller and smaller.
When it hits the ground, transaction gets reverted.</p><p>To avoid that, you should check if <code>getCurrentStakeLimit() &gt;= amountToStake</code>, and if it&#x27;s not you can go with an alternative route.
The staking rate limits are denominated in ether, thus, it makes no difference if the stake is being deposited for stETH or using <a href="#wsteth-shortcut">the wstETH shortcut</a>, the limits apply in both cases.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="alternative-routes">Alternative routes:<a class="hash-link" href="#alternative-routes" title="Direct link to heading">â€‹</a></h4><ol><li>Wait for staking limits to regenerate to higher values and retry depositing ether to Lido later.</li><li>Consider swapping ETH for stETH on DEXes like Curve or Balancer. At specific market conditions stETH may effectively be purchased from there with a discount due to stETH price fluctuations.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="transfer-shares-function-for-steth">Transfer shares function for stETH<a class="hash-link" href="#transfer-shares-function-for-steth" title="Direct link to heading">â€‹</a></h2><p>The <a href="https://github.com/lidofinance/lido-improvement-proposals/blob/develop/LIPS/lip-11.md" target="_blank" rel="noopener noreferrer">LIP-11</a> introduced the <code>transferShares</code> function which allows to transfer stETH in a &quot;rebase-agnostic&quot; manner: transfer in terms of <a href="#steth-internals-share-mechanics">shares</a> amount.</p><p>Normally, we transfer stETH using ERC-20 <code>transfer</code> and <code>transferFrom</code> functions which accept as input amount of stETH, not the amount of the underlying shares.
Sometimes we&#x27;d better operate with shares directly to avoid possible rounding issues. Rounding issues usually could appear after a token rebase.
This feature is aimed to provide an additional level of precision when operating with stETH.
Read more abut the function in the <a href="https://github.com/lidofinance/lido-improvement-proposals/blob/develop/LIPS/lip-11.md" target="_blank" rel="noopener noreferrer">LIP-11</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="general-integration-examples">General integration examples<a class="hash-link" href="#general-integration-examples" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="stethwsteth-as-collateral">stETH/wstETH as collateral<a class="hash-link" href="#stethwsteth-as-collateral" title="Direct link to heading">â€‹</a></h3><p>stETH/wstETH as DeFi collateral is beneficial for a number of reasons:</p><ul><li>stETH/wstETH is almost as safe as ether, price-wise: barring catastrophic scenarios, its value tends to hold the ETH peg well;</li><li>stETH/wstETH is a productive asset: earning rewards on collateral effectively lowers the cost of borrowing;</li><li>stETH/wstETH is a very liquid asset with billions of liquidity locked in liquidity pools (<a href="https://curve.fi/steth" target="_blank" rel="noopener noreferrer">Curve</a>, <a href="https://app.balancer.fi/#/pool/0x32296969ef14eb0c6d29669c550d4a0449130230000200000000000000000080" target="_blank" rel="noopener noreferrer">Balancer v2</a>)</li></ul><p>Lido&#x27;s staked assets have been listed on major liquidity protocols:</p><ul><li>On Maker, <a href="https://daistats.com/#/collateral" target="_blank" rel="noopener noreferrer">wstETH collateral (scroll down to Dai from WSTETH-A section)</a> can be used to mint DAI stablecoin. See <a href="https://blog.lido.fi/makerdao-integrates-lidos-staked-eth-steth-as-collateral-asset/" target="_blank" rel="noopener noreferrer">Lido&#x27;s blog post</a> for more details.</li><li>On AAVE, multiple assets can be <a href="https://app.aave.com/reserve-overview/?underlyingAsset=0xae7ab96520de3a18e5e111b5eaab095312d7fe84&amp;marketName=proto_mainnet" target="_blank" rel="noopener noreferrer">borrowed against stETH</a>. See <a href="https://blog.lido.fi/aave-integrates-lidos-steth-as-collateral/" target="_blank" rel="noopener noreferrer">Lido&#x27;s blog post</a> for more details. Please note: stETH is only supported on AAVE as lending collateral. Borrowing stETH on AAVE is not currently supported. However, any asset can be borrowed on AAVe via a flashloan. Due to a known <a href="#1-wei-corner-case">1 wei corner case</a> there&#x27;s a certain situation when a flashloan transaction can revert. Please visit <a href="https://docs.lido.fi/token-guides/steth-on-aave-caveats" target="_blank" rel="noopener noreferrer">stETH on AAVE caveats</a> article for more details.</li><li>On <a href="https://app.anchorprotocol.com/" target="_blank" rel="noopener noreferrer">Anchor</a>, ether stakers can collateralise their stETH (in the form of bETH) on the Terra blockchain using Anchor protocol. This integration is covered in great detail in <a href="https://github.com/lidofinance/anchor-collateral-steth/blob/main/docs/spec.md" target="_blank" rel="noopener noreferrer">the spec</a>.</li></ul><p>Robust price sources are required for listing on most money markets, with ChainLink price feeds being the industry standard. There&#x27;re live ChainLink <a href="https://app.ens.domains/name/steth-usd.data.eth" target="_blank" rel="noopener noreferrer">stETH/USD</a> and <a href="https://etherscan.io/address/0x86392dC19c0b719886221c78AB11eb8Cf5c52812" target="_blank" rel="noopener noreferrer">stETH/ETH</a> price feeds on Ethereum.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="wallet-integrations">Wallet integrations<a class="hash-link" href="#wallet-integrations" title="Direct link to heading">â€‹</a></h3><p>Lido&#x27;s Ethereum staking services have been successfully integrated into most popular DeFi wallets, including Ledger, MyEtherWallet, ImToken and others.
Having stETH integrated can provide wallet users with great user experience of direct staking from the wallet UI itself.</p><p>Lido DAO runs a referral program rewarding wallets and other apps for driving liquidity to the Lido staking protocol. At the moment, the referral program is in <a href="https://research.lido.fi/t/switch-referral-program-to-whitelist-mode/1014" target="_blank" rel="noopener noreferrer">whitelist mode</a>. Please contact Lido bizdev team to find out if your wallet might be eligible for referral program participation.</p><p>When adding stETH support to a DeFi wallet, it is important to preserve stETH&#x27;s rebasing nature. Avoid storing cached stETH balance for extended periods of time (over 24 hours), and keep in mind it doesn&#x27;t necessarily take a transaction to change stETH balance.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="liquidity-mining">Liquidity mining<a class="hash-link" href="#liquidity-mining" title="Direct link to heading">â€‹</a></h3><p>stETH liquidity is mostly concentrated in two biggest liquidity pools:</p><ul><li><a href="https://curve.fi/steth" target="_blank" rel="noopener noreferrer">stETH/ETH liquidity pool on Curve</a> (<a href="https://github.com/curvefi/curve-contract/blob/master/contracts/pools/steth/StableSwapSTETH.vy" target="_blank" rel="noopener noreferrer">contract code</a>)</li><li><a href="https://app.balancer.fi/#/pool/0x32296969ef14eb0c6d29669c550d4a0449130230000200000000000000000080" target="_blank" rel="noopener noreferrer">wstETH/WETH MetaStable pool on Balancer v2</a> (<a href="https://docs.balancer.fi/products/balancer-pools/metastable-pools#the-lido-wsteth-weth-liquidity-pool" target="_blank" rel="noopener noreferrer">read more</a>)</li></ul><p>Both pools are incentivised with Lido governance token (LDO) via direct incentives and bribes (veBAL bribes coming soon), and allow the liquidity providers to retain their exposure to earning Lido staking rewards.</p><ul><li>Curve pool allows providing liquidity in the form of any of the pooled assets or in both of them. From that moment on, all the staking rewards accrued by stETH go to the pool and not to the liquidity provider&#x27;s address. However, when withdrawing the liquidity, the liquidity provider will be able to get more than they have initially deposited.
Please note, when depositing exclusively stETH to Curve, the tokens are split between ether and stETH, with the precise balances fluctuating constantly due to price trading. Thus, the liquidity provider will only be eligible for about a half of rewards accrued by the stETH deposited. To avoid that, provide stETH and ether liquidity in equal parts.</li><li>Unlike Curve, Balancer pool is wstETH-based. wstETH doesn&#x27;t rebase, it accrues staking rewards by eventually increasing in price instead. Thus, when withdrawing liquidity form the Balancer pool, the liquidity providers get assets valued higher than what they have initially deposited.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cross-chain-bridging">Cross chain bridging<a class="hash-link" href="#cross-chain-bridging" title="Direct link to heading">â€‹</a></h3><p>The Lido&#x27;s liquid staking derivatives will eventually get bridged to various L2&#x27;s and sidechains.
Most cross chain token bridges have no mechanics to handle rebases. This means bridging stETH to other chains will prevent stakers from collecting their staking rewards. In the most common case, the rewards will naturally go to the bridge smart contract and never make it to the stakers.
While working on full-blown bridging solutions, the Lido contributors encourage the users to only bridge the non-rebasable representation of staked ether, namely wstETH.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="risks">Risks<a class="hash-link" href="#risks" title="Direct link to heading">â€‹</a></h2><ol><li>Smart contract security.
There is an inherent risk that Lido could contain a smart contract vulnerability or bug. The Lido code is open-sourced, audited and covered by an extensive bug bounty program to minimise this risk.
To mitigate smart contract risks, all of the core Lido contracts undergo multiple audits. Audit reports can be found <a href="https://github.com/lidofinance/audits#lido-protocol-audits" target="_blank" rel="noopener noreferrer">here</a>.
Besides, Lido is covered with a massive <a href="https://immunefi.com/bounty/lido/" target="_blank" rel="noopener noreferrer">Immunefi bugbounty program</a>.</li><li>Beacon chain - Technical risk.
Lido is built atop experimental technology under active development, and there is no guarantee that Beacon chain has been developed error-free. Any vulnerabilities inherent to Beacon chain brings with it slashing risk, as well as stETH balance fluctuation risk.</li><li>Beacon chain - Adoption risk.
The value of stETH is built around the staking rewards associated with the Ethereum beacon chain. If Beacon chain fails to reach required levels of adoption we could experience significant fluctuations in the value of ether and stETH.</li><li>Slashing risk.
Beacon chain validators risk staking penalties, with up to 40% of staked funds at risk if validators fail. To minimise this risk, Lido stakes across multiple professional and reputable node operators with heterogeneous setups, with additional mitigation in the form of in-protocol cover that may be paid from Lido fees.</li><li>stETH price risk.
Users risk an exchange price of stETH which is lower than inherent value due to withdrawal restrictions on Lido, making arbitrage and risk-free market-making impossible. The Lido DAO is driven to mitigate above risks and eliminate them entirely to the extent possible. Despite this, they may still exist and, as such, it is our duty to communicate them.</li><li>DAO key management risk.
On early stages of Lido, slightly more than 600k ether became held across multiple accounts backed by a multi-signature threshold scheme to minimize custody risk. If signatories across a certain threshold lose their key shares, get hacked or go rogue, Lido risks these funds (&lt;20% of total stake as of April 2022) becoming locked.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lidofinance/docs/blob/main/docs/guides/steth-integration-guide.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/lido-dao"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lido DAO</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/guides/node-operator-manual"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Node Operator Manual</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lido" class="table-of-contents__link toc-highlight">Lido</a></li><li><a href="#steth-vs-wsteth" class="table-of-contents__link toc-highlight">stETH vs. wstETH</a></li><li><a href="#steth" class="table-of-contents__link toc-highlight">stETH</a><ul><li><a href="#what-is-steth" class="table-of-contents__link toc-highlight">What is stETH</a></li><li><a href="#the-beacon-chain-oracle" class="table-of-contents__link toc-highlight">The Beacon chain oracle</a></li><li><a href="#steth-internals-share-mechanics" class="table-of-contents__link toc-highlight">stETH internals: share mechanics</a></li><li><a href="#1-wei-corner-case" class="table-of-contents__link toc-highlight">1 wei corner case</a></li><li><a href="#bookkeeping-shares" class="table-of-contents__link toc-highlight">Bookkeeping shares</a></li><li><a href="#fees" class="table-of-contents__link toc-highlight">Fees</a></li><li><a href="#do-steth-rewards-compound" class="table-of-contents__link toc-highlight">Do stETH rewards compound?</a></li></ul></li><li><a href="#wsteth" class="table-of-contents__link toc-highlight">wstETH</a><ul><li><a href="#what-is-wsteth" class="table-of-contents__link toc-highlight">What is wstETH</a></li><li><a href="#rewards-accounting" class="table-of-contents__link toc-highlight">Rewards accounting</a></li><li><a href="#wrap--unwrap" class="table-of-contents__link toc-highlight">Wrap &amp; Unwrap</a></li></ul></li><li><a href="#erc20permit" class="table-of-contents__link toc-highlight">ERC20Permit</a></li><li><a href="#staking-rate-limits" class="table-of-contents__link toc-highlight">Staking rate limits</a></li><li><a href="#transfer-shares-function-for-steth" class="table-of-contents__link toc-highlight">Transfer shares function for stETH</a></li><li><a href="#general-integration-examples" class="table-of-contents__link toc-highlight">General integration examples</a><ul><li><a href="#stethwsteth-as-collateral" class="table-of-contents__link toc-highlight">stETH/wstETH as collateral</a></li><li><a href="#wallet-integrations" class="table-of-contents__link toc-highlight">Wallet integrations</a></li><li><a href="#liquidity-mining" class="table-of-contents__link toc-highlight">Liquidity mining</a></li><li><a href="#cross-chain-bridging" class="table-of-contents__link toc-highlight">Cross chain bridging</a></li></ul></li><li><a href="#risks" class="table-of-contents__link toc-highlight">Risks</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.1683206d.js"></script>
<script src="/assets/js/main.4049db9f.js"></script>
</body>
</html>